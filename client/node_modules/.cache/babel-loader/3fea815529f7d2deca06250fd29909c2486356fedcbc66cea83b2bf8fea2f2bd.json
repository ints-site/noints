{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useEffect, useRef, useCallback } from 'react';\nimport { useDispatch } from 'react-redux';\nimport { updateNoteContent } from '../store/notebookSlice';\nexport function useAutoSave(noteId, content, delay = 2000, onSave) {\n  _s();\n  const dispatch = useDispatch();\n  const timeoutRef = useRef();\n  const contentRef = useRef(content);\n  const saveCounter = useRef(0);\n  const lastSave = useRef(Date.now());\n  useEffect(() => {\n    contentRef.current = content;\n  }, [content]);\n  const save = useCallback(async () => {\n    if (!noteId) return;\n    const now = Date.now();\n    if (now - lastSave.current < 1000) return;\n    try {\n      await dispatch(updateNoteContent({\n        id: noteId,\n        content: contentRef.current\n      }));\n      lastSave.current = now;\n      onSave === null || onSave === void 0 ? void 0 : onSave();\n    } catch (error) {\n      console.error('Auto-save failed:', error);\n    }\n  }, [noteId, dispatch, onSave]);\n  useEffect(() => {\n    if (timeoutRef.current) {\n      clearTimeout(timeoutRef.current);\n    }\n    timeoutRef.current = setTimeout(save, delay);\n    return () => {\n      if (timeoutRef.current) {\n        clearTimeout(timeoutRef.current);\n      }\n    };\n  }, [content, delay, save]);\n}\n_s(useAutoSave, \"aUEYIopMtaPDYE72MIhSWw1gPMY=\", false, function () {\n  return [useDispatch];\n});","map":{"version":3,"names":["useEffect","useRef","useCallback","useDispatch","updateNoteContent","useAutoSave","noteId","content","delay","onSave","_s","dispatch","timeoutRef","contentRef","saveCounter","lastSave","Date","now","current","save","id","error","console","clearTimeout","setTimeout"],"sources":["C:/Users/FanYukin/codes/f/noints/client/src/hooks/useAutoSave.ts"],"sourcesContent":["import { useEffect, useRef, useCallback } from 'react';\nimport { Descendant } from 'slate';\nimport { useDispatch } from 'react-redux';\nimport { updateNoteContent } from '../store/notebookSlice';\n\nexport function useAutoSave(\n  noteId: string | null,\n  content: Descendant[],\n  delay = 2000,\n  onSave?: () => void\n) {\n  const dispatch = useDispatch();\n  const timeoutRef = useRef<NodeJS.Timeout>();\n  const contentRef = useRef(content);\n  const saveCounter = useRef(0);\n  const lastSave = useRef(Date.now());\n\n  useEffect(() => {\n    contentRef.current = content;\n  }, [content]);\n\n  const save = useCallback(async () => {\n    if (!noteId) return;\n\n    const now = Date.now();\n    if (now - lastSave.current < 1000) return;\n\n    try {\n      await dispatch(updateNoteContent({\n        id: noteId,\n        content: contentRef.current\n      }));\n      lastSave.current = now;\n      onSave?.();\n    } catch (error) {\n      console.error('Auto-save failed:', error);\n    }\n  }, [noteId, dispatch, onSave]);\n\n  useEffect(() => {\n    if (timeoutRef.current) {\n      clearTimeout(timeoutRef.current);\n    }\n\n    timeoutRef.current = setTimeout(save, delay);\n\n    return () => {\n      if (timeoutRef.current) {\n        clearTimeout(timeoutRef.current);\n      }\n    };\n  }, [content, delay, save]);\n} "],"mappings":";AAAA,SAASA,SAAS,EAAEC,MAAM,EAAEC,WAAW,QAAQ,OAAO;AAEtD,SAASC,WAAW,QAAQ,aAAa;AACzC,SAASC,iBAAiB,QAAQ,wBAAwB;AAE1D,OAAO,SAASC,WAAWA,CACzBC,MAAqB,EACrBC,OAAqB,EACrBC,KAAK,GAAG,IAAI,EACZC,MAAmB,EACnB;EAAAC,EAAA;EACA,MAAMC,QAAQ,GAAGR,WAAW,CAAC,CAAC;EAC9B,MAAMS,UAAU,GAAGX,MAAM,CAAiB,CAAC;EAC3C,MAAMY,UAAU,GAAGZ,MAAM,CAACM,OAAO,CAAC;EAClC,MAAMO,WAAW,GAAGb,MAAM,CAAC,CAAC,CAAC;EAC7B,MAAMc,QAAQ,GAAGd,MAAM,CAACe,IAAI,CAACC,GAAG,CAAC,CAAC,CAAC;EAEnCjB,SAAS,CAAC,MAAM;IACda,UAAU,CAACK,OAAO,GAAGX,OAAO;EAC9B,CAAC,EAAE,CAACA,OAAO,CAAC,CAAC;EAEb,MAAMY,IAAI,GAAGjB,WAAW,CAAC,YAAY;IACnC,IAAI,CAACI,MAAM,EAAE;IAEb,MAAMW,GAAG,GAAGD,IAAI,CAACC,GAAG,CAAC,CAAC;IACtB,IAAIA,GAAG,GAAGF,QAAQ,CAACG,OAAO,GAAG,IAAI,EAAE;IAEnC,IAAI;MACF,MAAMP,QAAQ,CAACP,iBAAiB,CAAC;QAC/BgB,EAAE,EAAEd,MAAM;QACVC,OAAO,EAAEM,UAAU,CAACK;MACtB,CAAC,CAAC,CAAC;MACHH,QAAQ,CAACG,OAAO,GAAGD,GAAG;MACtBR,MAAM,aAANA,MAAM,uBAANA,MAAM,CAAG,CAAC;IACZ,CAAC,CAAC,OAAOY,KAAK,EAAE;MACdC,OAAO,CAACD,KAAK,CAAC,mBAAmB,EAAEA,KAAK,CAAC;IAC3C;EACF,CAAC,EAAE,CAACf,MAAM,EAAEK,QAAQ,EAAEF,MAAM,CAAC,CAAC;EAE9BT,SAAS,CAAC,MAAM;IACd,IAAIY,UAAU,CAACM,OAAO,EAAE;MACtBK,YAAY,CAACX,UAAU,CAACM,OAAO,CAAC;IAClC;IAEAN,UAAU,CAACM,OAAO,GAAGM,UAAU,CAACL,IAAI,EAAEX,KAAK,CAAC;IAE5C,OAAO,MAAM;MACX,IAAII,UAAU,CAACM,OAAO,EAAE;QACtBK,YAAY,CAACX,UAAU,CAACM,OAAO,CAAC;MAClC;IACF,CAAC;EACH,CAAC,EAAE,CAACX,OAAO,EAAEC,KAAK,EAAEW,IAAI,CAAC,CAAC;AAC5B;AAACT,EAAA,CA/CeL,WAAW;EAAA,QAMRF,WAAW;AAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}