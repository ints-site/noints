{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\FanYukin\\\\codes\\\\f\\\\noints\\\\client\\\\src\\\\components\\\\Editor\\\\NoteEditor.tsx\",\n  _s = $RefreshSig$();\nimport React, { useMemo, useState, useCallback } from 'react';\nimport { createEditor } from 'slate';\nimport { Slate, Editable, withReact } from 'slate-react';\nimport { withHistory } from 'slate-history';\nimport { useAutoSave } from '../../hooks/useAutoSave';\nimport Toolbar from './Toolbar';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst NoteEditor = ({\n  noteId\n}) => {\n  _s();\n  const editor = useMemo(() => withHistory(withReact(createEditor())), []);\n  const [value, setValue] = useState([{\n    type: 'paragraph',\n    children: [{\n      text: ''\n    }]\n  }]);\n  const [saveStatus, setSaveStatus] = useState('saved');\n  const [wordCount, setWordCount] = useState(0);\n\n  // 使用自动保存 hook\n  useAutoSave(noteId || null, value, () => {\n    setSaveStatus('saving');\n    // 模拟保存延迟\n    setTimeout(() => setSaveStatus('saved'), 1000);\n  });\n\n  // 计算字数\n  const calculateWordCount = useCallback(value => {\n    const text = value.map(n => Node.string(n)).join('\\n').trim();\n    return text.split(/\\s+/).filter(Boolean).length;\n  }, []);\n\n  // 导出功能\n  const handleExport = useCallback(format => {\n    const text = value.map(n => Node.string(n)).join('\\n');\n    const blob = new Blob([text], {\n      type: 'text/plain;charset=utf-8'\n    });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = `note.${format}`;\n    document.body.appendChild(a);\n    a.click();\n    document.body.removeChild(a);\n    URL.revokeObjectURL(url);\n  }, [value]);\n\n  // 处理快捷键\n  const handleKeyDown = useCallback(event => {\n    if (!event.ctrlKey) return;\n    switch (event.key) {\n      case 'b':\n        {\n          event.preventDefault();\n          editor.addMark('bold', true);\n          break;\n        }\n      case 'i':\n        {\n          event.preventDefault();\n          editor.addMark('italic', true);\n          break;\n        }\n      case 'u':\n        {\n          event.preventDefault();\n          editor.addMark('underline', true);\n          break;\n        }\n      case 'z':\n        {\n          event.preventDefault();\n          if (event.shiftKey) {\n            editor.redo();\n          } else {\n            editor.undo();\n          }\n          break;\n        }\n      case 'y':\n        {\n          event.preventDefault();\n          editor.redo();\n          break;\n        }\n    }\n  }, [editor]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"h-full flex flex-col\",\n    children: /*#__PURE__*/_jsxDEV(Slate, {\n      editor: editor,\n      value: value,\n      onChange: newValue => {\n        setValue(newValue);\n        setWordCount(calculateWordCount(newValue));\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"border-b flex items-center justify-between px-4 py-2\",\n        children: [/*#__PURE__*/_jsxDEV(Toolbar, {\n          onExport: handleExport\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 102,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex items-center gap-4\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"text-sm text-gray-500 flex items-center gap-1\",\n            children: [saveStatus === 'saving' && /*#__PURE__*/_jsxDEV(_Fragment, {\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"material-icons animate-spin text-blue-500\",\n                children: \"sync\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 108,\n                columnNumber: 19\n              }, this), \"Saving...\"]\n            }, void 0, true), saveStatus === 'saved' && /*#__PURE__*/_jsxDEV(_Fragment, {\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"material-icons text-green-500\",\n                children: \"check\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 114,\n                columnNumber: 19\n              }, this), \"Saved\"]\n            }, void 0, true), saveStatus === 'error' && /*#__PURE__*/_jsxDEV(_Fragment, {\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"material-icons text-red-500\",\n                children: \"error\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 120,\n                columnNumber: 19\n              }, this), \"Error saving\"]\n            }, void 0, true)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 105,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"text-sm text-gray-500\",\n            children: [wordCount, \" \", wordCount === 1 ? 'word' : 'words']\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 126,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 103,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 101,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex-1 p-6 overflow-auto\",\n        children: /*#__PURE__*/_jsxDEV(Editable, {\n          className: \"h-full outline-none prose max-w-none\",\n          renderElement: renderElement,\n          renderLeaf: renderLeaf,\n          placeholder: \"Start typing...\",\n          onKeyDown: handleKeyDown,\n          spellCheck: false\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 132,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 131,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 93,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 92,\n    columnNumber: 5\n  }, this);\n};\n_s(NoteEditor, \"PvFGigfvXop2rBo2+g/c+wOsWh8=\", false, function () {\n  return [useAutoSave];\n});\n_c = NoteEditor;\nexport default NoteEditor;\nvar _c;\n$RefreshReg$(_c, \"NoteEditor\");","map":{"version":3,"names":["React","useMemo","useState","useCallback","createEditor","Slate","Editable","withReact","withHistory","useAutoSave","Toolbar","jsxDEV","_jsxDEV","Fragment","_Fragment","NoteEditor","noteId","_s","editor","value","setValue","type","children","text","saveStatus","setSaveStatus","wordCount","setWordCount","setTimeout","calculateWordCount","map","n","Node","string","join","trim","split","filter","Boolean","length","handleExport","format","blob","Blob","url","URL","createObjectURL","a","document","createElement","href","download","body","appendChild","click","removeChild","revokeObjectURL","handleKeyDown","event","ctrlKey","key","preventDefault","addMark","shiftKey","redo","undo","className","onChange","newValue","onExport","fileName","_jsxFileName","lineNumber","columnNumber","renderElement","renderLeaf","placeholder","onKeyDown","spellCheck","_c","$RefreshReg$"],"sources":["C:/Users/FanYukin/codes/f/noints/client/src/components/Editor/NoteEditor.tsx"],"sourcesContent":["import React, { useMemo, useState, useCallback } from 'react';\r\nimport { createEditor, Descendant, Editor } from 'slate';\r\nimport { Slate, Editable, withReact } from 'slate-react';\r\nimport { withHistory } from 'slate-history';\r\nimport { useAutoSave } from '../../hooks/useAutoSave';\r\nimport Toolbar from './Toolbar';\r\nimport { CustomElement, CustomText } from './types';\r\n\r\ninterface EditorProps {\r\n  noteId?: string;\r\n}\r\n\r\nconst NoteEditor: React.FC<EditorProps> = ({ noteId }) => {\r\n  const editor = useMemo(() => withHistory(withReact(createEditor())), []);\r\n  const [value, setValue] = useState<Descendant[]>([\r\n    {\r\n      type: 'paragraph',\r\n      children: [{ text: '' }],\r\n    },\r\n  ]);\r\n  const [saveStatus, setSaveStatus] = useState<'saved' | 'saving' | 'error'>('saved');\r\n  const [wordCount, setWordCount] = useState(0);\r\n\r\n  // 使用自动保存 hook\r\n  useAutoSave(noteId || null, value, () => {\r\n    setSaveStatus('saving');\r\n    // 模拟保存延迟\r\n    setTimeout(() => setSaveStatus('saved'), 1000);\r\n  });\r\n\r\n  // 计算字数\r\n  const calculateWordCount = useCallback((value: Descendant[]) => {\r\n    const text = value\r\n      .map(n => Node.string(n))\r\n      .join('\\n')\r\n      .trim();\r\n    return text.split(/\\s+/).filter(Boolean).length;\r\n  }, []);\r\n\r\n  // 导出功能\r\n  const handleExport = useCallback((format: 'txt' | 'md' | 'html') => {\r\n    const text = value.map(n => Node.string(n)).join('\\n');\r\n    const blob = new Blob([text], { type: 'text/plain;charset=utf-8' });\r\n    const url = URL.createObjectURL(blob);\r\n    const a = document.createElement('a');\r\n    a.href = url;\r\n    a.download = `note.${format}`;\r\n    document.body.appendChild(a);\r\n    a.click();\r\n    document.body.removeChild(a);\r\n    URL.revokeObjectURL(url);\r\n  }, [value]);\r\n\r\n  // 处理快捷键\r\n  const handleKeyDown = useCallback((event: React.KeyboardEvent) => {\r\n    if (!event.ctrlKey) return;\r\n\r\n    switch (event.key) {\r\n      case 'b': {\r\n        event.preventDefault();\r\n        editor.addMark('bold', true);\r\n        break;\r\n      }\r\n      case 'i': {\r\n        event.preventDefault();\r\n        editor.addMark('italic', true);\r\n        break;\r\n      }\r\n      case 'u': {\r\n        event.preventDefault();\r\n        editor.addMark('underline', true);\r\n        break;\r\n      }\r\n      case 'z': {\r\n        event.preventDefault();\r\n        if (event.shiftKey) {\r\n          editor.redo();\r\n        } else {\r\n          editor.undo();\r\n        }\r\n        break;\r\n      }\r\n      case 'y': {\r\n        event.preventDefault();\r\n        editor.redo();\r\n        break;\r\n      }\r\n    }\r\n  }, [editor]);\r\n\r\n  return (\r\n    <div className=\"h-full flex flex-col\">\r\n      <Slate\r\n        editor={editor}\r\n        value={value}\r\n        onChange={newValue => {\r\n          setValue(newValue);\r\n          setWordCount(calculateWordCount(newValue));\r\n        }}\r\n      >\r\n        <div className=\"border-b flex items-center justify-between px-4 py-2\">\r\n          <Toolbar onExport={handleExport} />\r\n          <div className=\"flex items-center gap-4\">\r\n            {/* 保存状态指示器 */}\r\n            <div className=\"text-sm text-gray-500 flex items-center gap-1\">\r\n              {saveStatus === 'saving' && (\r\n                <>\r\n                  <span className=\"material-icons animate-spin text-blue-500\">sync</span>\r\n                  Saving...\r\n                </>\r\n              )}\r\n              {saveStatus === 'saved' && (\r\n                <>\r\n                  <span className=\"material-icons text-green-500\">check</span>\r\n                  Saved\r\n                </>\r\n              )}\r\n              {saveStatus === 'error' && (\r\n                <>\r\n                  <span className=\"material-icons text-red-500\">error</span>\r\n                  Error saving\r\n                </>\r\n              )}\r\n            </div>\r\n            {/* 字数统计 */}\r\n            <div className=\"text-sm text-gray-500\">\r\n              {wordCount} {wordCount === 1 ? 'word' : 'words'}\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div className=\"flex-1 p-6 overflow-auto\">\r\n          <Editable\r\n            className=\"h-full outline-none prose max-w-none\"\r\n            renderElement={renderElement}\r\n            renderLeaf={renderLeaf}\r\n            placeholder=\"Start typing...\"\r\n            onKeyDown={handleKeyDown}\r\n            spellCheck={false}\r\n          />\r\n        </div>\r\n      </Slate>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default NoteEditor; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}